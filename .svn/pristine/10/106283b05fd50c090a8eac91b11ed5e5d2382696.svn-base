<!-- 
 * == 개정이력(Modification Information) ==
 *   
 *   수정일      			수정자           수정내용
 *  ============   	============== =======================
 *  2025. 4. 3.     	손현진            최초 생성
 *
-->
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt" %>
<%@ taglib uri="http://www.springframework.org/security/tags" prefix="security" %>


<div class="selected-user">
	<span>To: <span class="name">Emily Russell</span></span>
</div>
   <div class="chat-container">
    <!-- lastTime 변수를 초기화 (페이지 범위) -->
<c:set var="lastTime" value="" scope="page" />

<ul class="chat-box chatContainerScroll" id="chatBox">
    <security:authentication property="principal" var="principal" />
    <c:forEach var="msg" items="${messageList}">
        <li class="${msg.senderEmpId eq principal.realUser.userId ? 'chat-right' : 'chat-left'}">
            <div class="chat-hour">
                <c:if test="${msg.sendTime ne lastTime}">
                    <c:out value="${msg.sendTime}" />
                    <!-- 현재 메시지의 sendTime을 lastTime으로 저장 -->
                    <c:set var="lastTime" value="${msg.sendTime}" scope="page" />
                </c:if>
            </div>
            <div class="chat-avatar">
                <img src="https://www.bootdey.com/img/Content/avatar/avatar3.png" alt="Avatar">
                <div class="chat-name">${msg.senderEmpId}</div>
            </div>
            <div class="chat-text">${msg.msgContent}</div>
        </li>
    </c:forEach>
</ul>
    <!-- 메시지 입력 영역 -->
    <div class="form-group mt-3 mb-0">
        <textarea class="form-control" rows="3" placeholder="Type your message here..." id="messageInput"></textarea>
        <button id="sendBtn" type="button">전송</button>
    </div>
</div>

