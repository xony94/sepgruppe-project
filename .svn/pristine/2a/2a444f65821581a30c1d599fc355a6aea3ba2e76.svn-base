/** 
 * <pre>
 * << 개정이력(Modification Information) >>
 *   
 *   수정일      			수정자           수정내용
 *  -----------   	-------------    ---------------------------
 * 2025. 4. 10.     	JYS            최초 생성
 *
 * </pre>
 */

function initVacationScript() {
  const form = document.querySelector('#docForm');
  if (!form || form.dataset.docType !== 'vacation') return;

  const today = new Date().toISOString().split('T')[0];

  const startDateEl = document.getElementById("startDate");
  const endDateEl = document.getElementById("endDate");
  const vacOptionEl = document.getElementById("vacOption");

  if (!startDateEl || !endDateEl || !vacOptionEl) return;

  startDateEl.setAttribute("min", today);
  endDateEl.setAttribute("min", today);

  // 휴가 옵션 select 박스 생성
  vacOptionEl.innerHTML = `
    <select id="vacOptionSelect">
      <option value="0">선택</option>
      <option value="1">연차</option>
      <option value="2">반차</option>
    </select>
    <div id="halfDayTypeWrapper" style="display:none; margin-top:5px;"></div>
  `;

  document.getElementById("vacOptionSelect").addEventListener("change", calculateVacationDays);
  startDateEl.addEventListener("change", calculateVacationDays);
  endDateEl.addEventListener("change", calculateVacationDays);

  calculateVacationDays(); // 초기 계산
}

function calculateVacationDays() {
  const vacOption = document.getElementById("vacOptionSelect")?.value;
  const startInput = document.getElementById("startDate");
  const endInput = document.getElementById("endDate");
  const vacDaysInput = document.getElementById("vacDaysInput");
  const halfDaySelectWrapper = document.getElementById("halfDayTypeWrapper");

  if (!startInput || !endInput || !vacDaysInput || !halfDaySelectWrapper) return;

  if (vacOption === "2") { // 반차
    endInput.disabled = true;
    vacDaysInput.value = 0.5;
    halfDaySelectWrapper.style.display = 'block';
    halfDaySelectWrapper.innerHTML = `
      <label for="halfDayType">반차 시간 선택:</label>
      <select id="halfDayType">
        <option value="AM">오전 반차</option>
        <option value="PM">오후 반차</option>
      </select>
    `;
  } else if (vacOption === "1") { // 연차
    endInput.disabled = false;
    halfDaySelectWrapper.style.display = 'none';
    halfDaySelectWrapper.innerHTML = '';

    const start = new Date(startInput.value);
    const end = new Date(endInput.value);

    if (!isNaN(start) && !isNaN(end) && end >= start) {
      const diffTime = end - start;
      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
      vacDaysInput.value = diffDays;
    } else {
      vacDaysInput.value = '';
    }
  } else {
    endInput.disabled = false;
    vacDaysInput.value = '';
    halfDaySelectWrapper.style.display = 'none';
    halfDaySelectWrapper.innerHTML = '';
  }
}

