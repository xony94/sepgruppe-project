<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>

<style>
    html, body {
        height: 100%;
        margin: 0;
        padding: 0;
    }

    .community-wrapper {
        display: flex;
        height: 100%;
    }

    .community-left {
        width: 250px;
        padding: 20px;
        border-right: 2px solid #ddd;
        background-color: #f9f9f9;
        overflow-y: auto;
    }

    .community-right {
        flex-grow: 1;
        padding: 20px;
        background-color: #fff;
        overflow-y: auto;
    }

    .community-item {
        cursor: pointer;
        padding: 8px;
        border-radius: 5px;
    }

    .community-item:hover {
        background-color: #e8f0ff;
    }

    .btn-create {
        margin-bottom: 20px;
    }

    .community-title {
        font-size: 1.5rem;
        font-weight: bold;
        margin-bottom: 15px;
    }

    .member-list img {
        object-fit: cover;
    }

    .member-list li {
        font-size: 0.9rem;
    }

    .btn-back-home {
        float: right;
        margin-bottom: 10px;
    }
</style>

<div class="community-wrapper">
    <!-- ì™¼ìª½ ì˜ì—­ -->
    <div class="community-left" id="community-left">
        <button class="btn btn-primary btn-create"
                onclick="location.href='${pageContext.request.contextPath}/${companyNo}/community/create'">
            ë°© ë§Œë“¤ê¸°
        </button>

        <ul class="list-unstyled">
            <li class="community-item" onclick="loadCommunity('comm1')">ê°œë°œì ì»¤ë®¤ë‹ˆí‹°</li>
            <li class="community-item" onclick="loadCommunity('comm2')">ë””ìì¸ ì»¤ë®¤ë‹ˆí‹°</li>
            <li class="community-item" onclick="loadCommunity('comm3')">ë§ˆì¼€íŒ… ì»¤ë®¤ë‹ˆí‹°</li>
        </ul>

        <h6 class="mt-4">ê°€ì… ë©¤ë²„</h6>
        <ul class="member-list list-unstyled" id="member-list"></ul>

        <hr/>
        <button class="btn btn-outline-primary w-100 mb-2">ì´ˆëŒ€í•˜ê¸°</button>
        <button class="btn btn-outline-danger w-100">íƒˆí‡´í•˜ê¸°</button>
    </div>

    <!-- ì˜¤ë¥¸ìª½ ì˜ì—­ -->
    <div class="community-right" id="community-content">
        <button class="btn btn-secondary btn-back-home" onclick="goHome()">ğŸ  ì´ˆê¸°í™”ë©´ìœ¼ë¡œ</button>
        <div class="community-title">ì»¤ë®¤ë‹ˆí‹° í™ˆ</div>
        <p>ì¢Œì¸¡ì—ì„œ ì»¤ë®¤ë‹ˆí‹°ë¥¼ ì„ íƒí•˜ë©´ ìƒì„¸ ì •ë³´ê°€ ì´ê³³ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
    </div>
</div>

<script>
const dummyData = {
    "comm1": {
        name: "ê°œë°œì ì»¤ë®¤ë‹ˆí‹°",
        desc: "ê°œë°œ ê´€ë ¨ ì •ë³´ì™€ í† ë¡ ì„ ìœ„í•œ ê³µê°„ì…ë‹ˆë‹¤.",
        posts: ["ìë°” ì§ˆë¬¸ ìˆì–´ìš”", "ìŠ¤í”„ë§ ë¶€íŠ¸ ê¿€íŒ", "ì´ë ¥ì„œ ë¦¬ë·°í•´ ì£¼ì„¸ìš”"],
        members: [
            { name: "í™ê¸¸ë™", position: "ê³¼ì¥", profileImg: "https://via.placeholder.com/32" },
            { name: "ê¹€ê°œë°œ", position: "ëŒ€ë¦¬", profileImg: "https://via.placeholder.com/32" },
            { name: "ì´í”„ë¡œê·¸", position: "ì‚¬ì›", profileImg: "https://via.placeholder.com/32" }
        ]
    },
    "comm2": {
        name: "ë””ìì¸ ì»¤ë®¤ë‹ˆí‹°",
        desc: "ë””ìì¸ íŠ¸ë Œë“œì™€ í¬íŠ¸í´ë¦¬ì˜¤ ê³µìœ  ê³µê°„ì…ë‹ˆë‹¤.",
        posts: ["UI íŠ¸ë Œë“œ", "Figma í”ŒëŸ¬ê·¸ì¸ ì¶”ì²œ", "ë¡œê³  í”¼ë“œë°± ìš”ì²­"],
        members: [
            { name: "ë°•ë””ìì´ë„ˆ", position: "íŒ€ì¥", profileImg: "https://via.placeholder.com/32" },
            { name: "ìµœí¬ë¦¬ì—ì´í‹°ë¸Œ", position: "ê³¼ì¥", profileImg: "https://via.placeholder.com/32" }
        ]
    },
    "comm3": {
        name: "ë§ˆì¼€íŒ… ì»¤ë®¤ë‹ˆí‹°",
        desc: "ë§ˆì¼€íŒ… ì „ëµê³¼ ì•„ì´ë””ì–´ë¥¼ ë‚˜ëˆ„ëŠ” ê³³ì…ë‹ˆë‹¤.",
        posts: ["SNS ìš´ì˜ ì „ëµ", "ê´‘ê³  ì„±ê³¼ ë¶„ì„", "ì½˜í…ì¸  ìº˜ë¦°ë” ê³µìœ "],
        members: [
            { name: "ì¥ë§ˆì¼€íŒ…", position: "ì°¨ì¥", profileImg: "https://via.placeholder.com/32" },
            { name: "ì‹ í™ë³´", position: "ì‚¬ì›", profileImg: "https://via.placeholder.com/32" }
        ]
    }
};

function loadCommunity(communityId, push = true) {
    const data = dummyData[communityId];
    const right = document.getElementById("community-content");
    const memberList = document.getElementById("member-list");

    if (data) {
        const postsList = data.posts.map(post => `<li>${post}</li>`).join("");
        right.innerHTML = `
            <button class="btn btn-secondary btn-back-home" onclick="goHome()">ğŸ  ì´ˆê¸°í™”ë©´ìœ¼ë¡œ</button>
            <div class="community-title">${data.name}</div>
            <p>${data.desc}</p>
            <hr/>
            <h5>ìµœê·¼ ê²Œì‹œë¬¼</h5>
            <ul>${postsList}</ul>
        `;

        memberList.innerHTML = data.members.map(m => `
            <li class="d-flex align-items-center mb-2">
                <img src="${m.profileImg}" class="rounded-circle me-2" width="32" height="32">
                <div>
                    <strong>${m.name}</strong><br>
                    <span class="text-muted" style="font-size: 0.8rem;">${m.position}</span>
                </div>
            </li>
        `).join("");

        if (push) {
            history.pushState({ page: communityId }, '', '');
        }
    }
}

function goHome(push = true) {
    const right = document.getElementById("community-content");
    const memberList = document.getElementById("member-list");

    right.innerHTML = `
        <button class="btn btn-secondary btn-back-home" onclick="goHome()">ğŸ  ì´ˆê¸°í™”ë©´ìœ¼ë¡œ</button>
        <div class="community-title">ì»¤ë®¤ë‹ˆí‹° í™ˆ</div>
        <p>ì¢Œì¸¡ì—ì„œ ì»¤ë®¤ë‹ˆí‹°ë¥¼ ì„ íƒí•˜ë©´ ìƒì„¸ ì •ë³´ê°€ ì´ê³³ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
    `;
    memberList.innerHTML = "";

    if (push) {
        history.pushState({ page: "home" }, '', '');
    }
}

window.addEventListener("popstate", function (event) {
    if (!event.state || event.state.page === "home") {
        goHome(false);
    } else {
        loadCommunity(event.state.page, false);
    }
});

// ì´ˆê¸° ìƒíƒœ ë“±ë¡
document.addEventListener("DOMContentLoaded", () => {
    goHome(false);
});
</script>
