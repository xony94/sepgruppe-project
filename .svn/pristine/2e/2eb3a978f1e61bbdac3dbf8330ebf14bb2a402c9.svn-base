<!-- 
 * ìƒˆ ê²°ì¬ ë¬¸ì„œ ì‘ì„±
 * == ê°œì •ì´ë ¥(Modification Information) ==
 *   
 *   ìˆ˜ì •ì¼      			ìˆ˜ì •ì           ìˆ˜ì •ë‚´ìš©
 *  ============   	============== =======================
 *  2025. 3. 25.     	JYS            ìµœì´ˆ ìƒì„±
 *
-->
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<!DOCTYPE html>
<html>
<style>
    .btn {
        background: none;
        border: none;
        color: inherit;
        font-size: 1rem;
        cursor: pointer;
        padding: 5px 10px;
    }
    .btn:hover {
        text-decoration: underline;
    }
    
    .tree-container {
        width: 100%;
        height: 600px; /* ë†’ì´ ê³ ì • */
        border: 1px solid #ccc; /* í…Œë‘ë¦¬ ì¶”ê°€ */
        padding: 10px;
        overflow: hidden; /* ë¶€ëª¨ ìš”ì†Œì—ì„œëŠ” ìŠ¤í¬ë¡¤ ì•ˆ ìƒê¸°ê²Œ */
    }
    
    #tree {
        width: 100%;
        height: 100%; /* ë¶€ëª¨ ë†’ì´ë¥¼ ë”°ë¼ê° */
        overflow: auto; /* ë‚´ìš©ì´ ë§ì•„ì§€ë©´ ìŠ¤í¬ë¡¤ ìƒì„± */
    }
    
    
</style>
<div>
	<button type="button" class="btn" onclick="location.href='apprForm.jsp'">
		<i class="fa fa-paper-plane"></i>ê²°ì¬ìš”ì²­
	</button>
	<button type="button" class="btn" data-bs-dismiss="modal" onclick="">
		<i class="fa fa-save"></i>ì„ì‹œì €ì¥
	</button>
	<button type="button" class="btn" data-bs-dismiss="modal" onclick="previewContent()">
		<i class="fa fa-eye"></i>ë¯¸ë¦¬ë³´ê¸°
	</button>
	<button type="button" class="btn" data-bs-dismiss="modal" onclick="history.back()">
		<i class="fa fa-times-circle"></i>ì·¨ì†Œ
	</button>
	<button type="button" class="btn" data-bs-toggle="modal" data-bs-target="#apprInfoModal">
		<i class="fa fa-file-alt"></i>ê²°ì¬ì •ë³´
	</button>
</div>
<hr />
<div class="container-fluid">
	<div class="row">
         	 <!-- ê²°ì¬ì–‘ì‹ ì„ íƒ (ì¢Œì¸¡)-->
		<div id="tree-conotainer" class="col" >
			<span>ê²°ì¬ ì–‘ì‹ ì„ íƒ</span>
			<div class="input-group">
			    <input type="text" id="searchDoc" class="form-control" placeholder="ì–‘ì‹ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”.">
			    <button type="submit" class="btn btn-outline-primary">ğŸ”</button>
			</div>
				<div id= "tree">
	    			<!--ajax ì‘ë‹µ -->
	    		</div>
        </div>
        <!-- ê²°ì¬ì–‘ì‹ ìƒì„¸ë³´ê¸°(ìš°ì¸¡) -->
        <div class="col-md-8 ">
        	ê²°ì¬ ì–‘ì‹ ìƒì„¸ë³´ê¸°
         	<div id="templateDetails">
         		<textarea class="form-control" id="editor" name ="content" >ì–‘ì‹ì„ ì„ íƒí•˜ë©´ ìƒì„¸ ì •ë³´ê°€ í‘œì‹œë©ë‹ˆë‹¤.</textarea>
         	</div>
       	</div>
       	<div class="col">
       		<span>ê²°ì¬ì„ </span>
       	</div>
    </div>
 </div>
<!-- ê²°ì¬ ì •ë³´ ëª¨ë‹¬ -->
<div class="modal fade" id="apprInfoModal" tabindex="-1" role="dialog" aria-labelledby="apprInfoModalLabel" aria-modal="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="apprInfoModalLabel">ê²°ì¬ì •ë³´</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <!-- ê²°ì¬ì •ë³´ ë‚´ìš©ì„ ì—¬ê¸°ì— ì‘ì„±í•˜ì„¸ìš” -->
        <div id="modal-tree-container" class="col">
          <div id="depTree">
            <!-- ajax ì‘ë‹µ -->
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
        <button type="button" class="btn btn-primary">ì €ì¥</button>
      </div>
    </div>
  </div>
</div>


<script defer="defer">
document.addEventListener("DOMContentLoaded", () => {
	CKEDITOR.replace('editor', {
		versionCheck: false,
        height: 600, // ì›í•˜ëŠ” ë†’ì´(px)
        width: '100%' // ê°€ë¡œ í¬ê¸°(í¼ì„¼íŠ¸ ë˜ëŠ” px)
    });
});

let newWindow = null; // ì „ì—­ë³€ìˆ˜ë¡œ ë¯¸ë¦¬ë³´ê¸° ì°½ ì°¸ì¡°

function previewContent() {
    const editor = CKEDITOR.instances['editor'];  // CKEditor ì¸ìŠ¤í„´ìŠ¤ ê°€ì ¸ì˜¤ê¸°

    if (!editor) {
        alert("CKEditorê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
        return;  // editorê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ì„ ê²½ìš° ë¯¸ë¦¬ë³´ê¸° ê¸°ëŠ¥ ì‹¤í–‰í•˜ì§€ ì•ŠìŒ
    }

    const content = editor.getData();  // CKEditorì—ì„œ ì…ë ¥í•œ HTML ê°€ì ¸ì˜¤ê¸°
    localStorage.setItem("ckeditor_content", content);
    
 	// ì´ë¯¸ ì—´ë ¤ ìˆëŠ” ë¯¸ë¦¬ë³´ê¸° ì°½ì´ ìˆë‹¤ë©´ ë‹«ê¸°
    if (newWindow && !newWindow.closed) {
        newWindow.close();
    }

    // ìƒˆ ì°½ ì—´ê¸°
     newWindow = window.open(`${pageContext.request.contextPath}/${companyNo}/content`, "_blank", "width=800,height=600");
 
  	// ì°½ì„ ë‹«ê±°ë‚˜ ìƒˆë¡œê³ ì¹¨í•  ë•Œ localStorage ì´ˆê¸°í™”
     window.addEventListener("beforeunload", () => {
         localStorage.removeItem("ckeditor_content");
     });
}


</script>

<!-- js -->
<script src="${pageContext.request.contextPath }/resources/groupware/js/approval/apprForm_ft.js"></script>
<script src="${pageContext.request.contextPath }/resources/groupware/js/organization/depForm_ft.js"></script>
<%-- <script src="${pageContext.request.contextPath }/resources/groupware/js/approval/ckEditorPreview.js"></script> --%>
