<!-- 
 * == 개정이력(Modification Information) ==
 *   
 *   수정일      			수정자           수정내용
 *  ============   	============== =======================
 *  2025. 3. 24.     	SJH            최초 생성
 *
-->
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<html>
<head>
    <title>${result.title} - 설문 결과</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 30px; text-align: center; background: #f4f7fc; }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 800px;
            margin: auto;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        canvas { max-width: 400px; margin-bottom: 40px; }
    </style>
</head>
<body>
<div class="container">
    <h2>${result.title}</h2>
    <p>${result.description}</p>

    <c:forEach var="q" items="${result.questionStats}">
        <div class="question-block">
            <h4>${q.questionText}</h4>
            <canvas id="chart_${q.questionId}"></canvas>
            <script>
                const ctx_${q.questionId} = document.getElementById("chart_${q.questionId}").getContext("2d");
                new Chart(ctx_${q.questionId}, {
                    type: 'pie',
                    data: {
                        labels: [
                            <c:forEach var="entry" items="${q.answerCount}" varStatus="vs">
                                "${entry.key}"<c:if test="${!vs.last}">,</c:if>
                            </c:forEach>
                        ],
                        datasets: [{
                            data: [
                                <c:forEach var="entry" items="${q.answerCount}" varStatus="vs">
                                    ${entry.value}<c:if test="${!vs.last}">,</c:if>
                                </c:forEach>
                            ],
                            backgroundColor: ["#3498db", "#e67e22", "#2ecc71", "#9b59b6", "#e74c3c"]
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { position: 'bottom' }
                        }
                    }
                });
            </script>
        </div>
    </c:forEach>
</div>
</body>
</html>
