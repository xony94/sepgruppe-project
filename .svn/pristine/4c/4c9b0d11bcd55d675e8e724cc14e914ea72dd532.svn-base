<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<security:authentication property="principal.realUser" var="realUser"/> <!-- Provider 시큐리티 정보 -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

<link rel="stylesheet" href="${pageContext.request.contextPath }/resources/groupware/css/community/communityList.css" />
<%--  커뮤니티 ${communityList } <br> --%>
<%-- 리얼유저 ${realUser } --%>
<%-- 커뮤니티 전체 ${allCommunityList } --%>

<div class="community-wrapper">
    <!-- 왼쪽 영역 -->
    <div class="community-left" id="community-left">
        <a class="btn btn-outline-primary btn-create" id="roomInsert">
            <i class="bi bi-door-open"></i> 방 만들기
        </a>

        <!-- 가입 커뮤니티 -->
        <ul class="list-unstyled">
            <li class="d-flex justify-content-between align-items-center">
                <h6 class="mb-0" style="font-weight: 500;">가입 커뮤니티</h6>
                <i class="bi bi-chevron-down toggle-communities" id="toggle-communities"></i>
            </li>

            <!-- 커뮤니티 목록 -->
            <ul class="community-list" id="community-list" style="display: block; list-style-type: none; padding-left: 0;">
                <c:forEach var="community" items="${communityList}">
                    <li class="community-item d-flex justify-content-between align-items-center" data-community-no="${community.communityNo}" style="padding: 8px 12px; border-bottom: 1px solid #ddd;">
                        ${community.communityNm}
                        <!-- 멤버가 방 주인인 경우 오른쪽에 톱니바퀴 아이콘 추가 -->
                        <c:forEach var="member" items="${community.communityMember}">
                            <c:if test="${member.memberRole == '방 주인'}">
                                <i class="bi bi-gear roomManagement" style="float: right; cursor: pointer" title="방관리" data-community-no="${community.communityNo }"></i>
                            </c:if>
                        </c:forEach>
                    </li>
                </c:forEach>
            </ul>

            <!-- 가입 멤버 목록 (처음엔 보이지 않음) -->
            <h6 class="mt-4" id="member-title" style="display: none;">가입 멤버</h6>
            <ul class="member-list list-unstyled" id="member-list" style="display: none;"></ul>

            <!-- 초대하기, 탈퇴하기 버튼 (처음엔 보이지 않음) -->
            <button class="btn btn-outline-primary w-100 mb-2" id="invite-btn" style="display: none;">초대하기</button>
            <button class="btn btn-outline-danger w-100" id="leave-btn" style="display: none;">탈퇴하기</button>
        </ul>
    </div>

    <!-- 오른쪽 영역 -->
    <div class="community-right" id="community-content">
        <!-- 모든 오른쪽 요소들이 그려질 div -->
        <div class="content"></div>

        <!-- 초기화면 카드 시작 -->
        <div id="card">
            <!-- 최근 글과 전체 커뮤니티 메뉴 -->
            <div class="mb-3" id="mainCard">
                <div class="card-body">
                    <ul class="nav nav-tabs nav-tabs-bordered" id="community-tabs">
                        <!-- 최근 글 탭 -->
                        <li class="nav-item">
                            <button class="nav-link active" id="recent-articles-tab" data-bs-target="#recent-articles">
                                가입 커뮤니티
                            </button>
                        </li>
                        <!-- 전체 커뮤니티 탭 -->
                        <li class="nav-item">
                            <button class="nav-link" id="all-communities-tab" data-bs-target="#all-communities">
                                전체 커뮤니티
                            </button>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="tab-content pt-2" id="tabContent">
                <!-- 최근 글 탭 내용 -->
                <div id="recent-articles" class="tab-pane fade show active">
                    <ul id="recent-articles-list" class="list-unstyled">
                        <div class="table-responsive">
                            <table id="add-row" class="table table-hover display">
                                <thead>
                                    <tr>
                                        <th><input type="checkbox" id="select-all" /></th>
                                        <th>커뮤니티명</th>
                                        <th>마스터명</th>
                                        <th>회원수</th>
                                        <th>전체글수</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <c:forEach var="community" items="${communityList}">
                                        <tr>
                                            <td><input type="checkbox"></td>
                                            <td>${community.communityNm}</td> <!-- 커뮤니티명 -->
                                            <td>${community.employee.empNm}</td> <!-- 마스터명 -->
                                            <td>${community.memberCount}</td> <!-- 회원수 -->
                                            <td>${community.postCount}</td> <!-- 개설일 -->
                                        </tr>
                                    </c:forEach>
                                </tbody>
                            </table>
                        </div>
                    </ul>
                </div>

                <!-- 전체 커뮤니티 탭 내용 -->
                <div id="all-communities" class="tab-pane fade">
                    <ul id="all-communities-list" class="list-unstyled">
                        <div class="table-responsive">
                            <table id="add-row" class="table table-hover display">
                                <thead>
                                    <tr>
                                        <th><input type="checkbox" id="select-all" /></th>
                                        <th>커뮤니티명</th>
                                        <th>마스터명</th>
                                        <th>개설일</th>
                                        <th>회원수</th>
                                        <th>가입</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <c:forEach var="community" items="${allCommunityList}">
                                        <tr>
                                            <td><input type="checkbox"></td>
                                            <td>${community.communityNm}</td> <!-- 커뮤니티명 -->
                                            <td>${community.employee.empNm}</td> <!-- 마스터명 -->
                                            <td>${community.communityCreatedAt}</td> <!-- 개설일 -->
                                            <td>${community.memberCount}</td> <!-- 회원수 -->
                                            <td>
                                                <c:choose>
                                                    <c:when test="${empty community.joinedEmpId}">
                                                        <a class="btn btn-sm btn-primary">가입하기</a>
                                                    </c:when>
                                                    <c:otherwise>
                                                        <a class="btn btn-sm btn-danger">탈퇴하기</a>
                                                    </c:otherwise>
                                                </c:choose>
                                            </td> <!-- 가입 상태 -->
                                        </tr>
                                    </c:forEach>
                                </tbody>
                            </table>
                        </div>
                    </ul>
                </div>
            </div>
        </div>

        <!-- 톱니바퀴 눌렀을때 보여지는 요소(처음에는 안보여짐) -->
    </div>
</div>

<script src="${pageContext.request.contextPath }/resources/groupware/js/community/communityList.js"></script>

<script>
    var companyNo = '${companyNo}';
</script>
