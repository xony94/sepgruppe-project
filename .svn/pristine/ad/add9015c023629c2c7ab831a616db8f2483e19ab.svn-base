package kr.or.ddit.works.webhard.service;


import java.io.FileNotFoundException;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.security.GeneralSecurityException;
import java.util.ArrayList;
import java.util.Collections;
import java.util.List;

import org.checkerframework.common.reflection.qual.GetClass;
import org.springframework.core.io.ClassPathResource;
import org.springframework.stereotype.Service;
import org.springframework.web.multipart.MultipartFile;

import com.google.api.client.auth.oauth2.Credential;
import com.google.api.client.extensions.java6.auth.oauth2.AuthorizationCodeInstalledApp;
import com.google.api.client.extensions.jetty.auth.oauth2.LocalServerReceiver;
import com.google.api.client.googleapis.auth.oauth2.GoogleAuthorizationCodeFlow;
import com.google.api.client.googleapis.auth.oauth2.GoogleCredential;
import com.google.api.client.googleapis.javanet.GoogleNetHttpTransport;
import com.google.api.client.http.FileContent;
import com.google.api.client.http.InputStreamContent;
import com.google.api.client.http.javanet.NetHttpTransport;
import com.google.api.services.drive.Drive;
import com.google.api.services.drive.DriveScopes;
import com.google.api.services.drive.model.File;
import com.google.api.services.drive.model.FileList;
import com.google.gson.Gson;

import kr.or.ddit.works.webhard.config.WebhardConfig;
import kr.or.ddit.works.webhard.vo.GoogleDriveFileVO;

import com.google.api.client.json.JsonFactory;
import com.google.api.client.json.gson.GsonFactory;
import com.google.api.client.json.jackson2.JacksonFactory;
import com.google.api.client.util.store.FileDataStoreFactory;


/**
 * 웹하드 서비스 임플
 * @author KMJ
 * @since 2025. 3. 26.
 * @see
 *
 * <pre>
 * << 개정이력(Modification Information) >>
 *   
 *   수정일      			수정자           수정내용
 *  -----------   	-------------    ---------------------------
 *  2025. 3. 26.     	KMJ	          최초 생성
 *
 * </pre>
 */
@Service
public class WebhardServiceImpl implements WebhardService {
	
	@Override
    public List<GoogleDriveFileVO> getDriveFiles() {
        List<GoogleDriveFileVO> fileList = new ArrayList<>();
        try {
            Drive driveService = WebhardConfig.getDriveService();

            FileList result = driveService.files().list()
                    .setPageSize(10)
                    .setFields("files(id, name, mimeType, webViewLink)")
                    .execute();

            for (File file : result.getFiles()) {
                GoogleDriveFileVO vo = new GoogleDriveFileVO(
                        file.getId(),
                        file.getName(),
                        file.getMimeType(),
                        file.getWebViewLink()
                );
                fileList.add(vo);
            }
        } catch (IOException | GeneralSecurityException e) {
            e.printStackTrace();
        }
        return fileList;
    }

}
