/** 
 * <pre>
 * << ê°œì •ì´ë ¥(Modification Information) >>
 *   
 *   ìˆ˜ì •ì¼      			ìˆ˜ì •ì           ìˆ˜ì •ë‚´ìš©
 *  -----------   	-------------    ---------------------------
 * 2025. 3. 20.     	JYS            ìµœì´ˆ ìƒì„±
 *
 * </pre>
 */
// DOMContentLoaded ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´ ì‹¤í–‰
document.addEventListener("DOMContentLoaded", () => {
	const apprModal = document.querySelector('#newApprModal');
	const basePath = window.location.pathname.split("/").slice(0, -1).join("/");
	
    // ê²°ì¬ ì–‘ì‹ ì „ì²´ ì¡°íšŒ
    apprModal.addEventListener('show.bs.modal', async () => {
        try {
            // Axiosë¥¼ ì‚¬ìš©í•´ ë¹„ë™ê¸°ë¡œ ê²°ì¬ ì–‘ì‹ ë°ì´í„°ë¥¼ ìš”ì²­
            const response = await axios.get(`${basePath}/approval/allDocuments`);
            const resp = response.data; // ì‘ë‹µ ë°ì´í„°
            const templateTree = document.querySelector("#templateTree"); // íŠ¸ë¦¬ êµ¬ì¡°ë¥¼ í‘œì‹œí•  DOM ìš”ì†Œ
            templateTree.innerHTML = ""; // ê¸°ì¡´ ë¦¬ìŠ¤íŠ¸ë¥¼ ë¹„ì›€

            if (Object.keys(resp).length > 0) {
                const fragment = document.createDocumentFragment(); // ì„±ëŠ¥ ìµœì í™”ë¥¼ ìœ„í•œ DocumentFragment (DOM íŠ¸ë¦¬ì˜ ë³€ê²½ ì‚¬í•­ì„ ë©”ëª¨ë¦¬ ìƒì—ì„œ ì²˜ë¦¬)

                // "No Parent" í´ë”ë¥¼ ë¨¼ì € ë³´ì—¬ì£¼ê¸° ìœ„í•´ ì •ë ¬
                const sortedFolders = Object.entries(resp).sort(([a], [b]) => (a === "No Parent" ? -1 : b === "No Parent" ? 1 : 0));

                sortedFolders.forEach(([parentFolderName, subFolders]) => {
                    const parentFolderGroup = document.createElement("ul"); // ìƒìœ„ í´ë”ë¥¼ ìœ„í•œ ë¦¬ìŠ¤íŠ¸ ìƒì„±
                    parentFolderGroup.classList.add("list-group");

                    // ìƒìœ„ í´ë” ì•„ì´í…œ ìƒì„±
                    const parentFolderItem = document.createElement("li");
                    parentFolderItem.classList.add("list-group-item", "active");
                    parentFolderItem.textContent = `ğŸ“‚ ${parentFolderName}`; // ìƒìœ„ í´ë” ì´ë¦„
                    parentFolderGroup.appendChild(parentFolderItem);

                    // ê° í•˜ìœ„ í´ë” ì²˜ë¦¬
                    Object.entries(subFolders).forEach(([folderName, documents]) => {
                        const folderGroup = document.createElement("ul"); // í•˜ìœ„ í´ë”ë¥¼ ìœ„í•œ ë¦¬ìŠ¤íŠ¸ ìƒì„±
                        folderGroup.classList.add("list-group");

                        // í•˜ìœ„ í´ë” ì•„ì´í…œ ìƒì„±
                        const folderItem = document.createElement("li");
                        folderItem.classList.add("list-group-item", "active");
                        folderItem.textContent = `ğŸ“ ${folderName}`; // í•˜ìœ„ í´ë” ì´ë¦„
                        folderGroup.appendChild(folderItem);

                        // í•˜ìœ„ í´ë”ì— ì†í•œ ê° ë¬¸ì„œ ì²˜ë¦¬
                        documents.forEach(doc => {
                            const docItem = document.createElement("li"); // ë¬¸ì„œ ì•„ì´í…œ ìƒì„±
                            docItem.classList.add("list-group-item");
                            docItem.textContent = `ğŸ“„ ${doc.docFrmName}`; // ë¬¸ì„œ ì´ë¦„
                            folderGroup.appendChild(docItem);
                        });

                        parentFolderGroup.appendChild(folderGroup); // í•˜ìœ„ í´ë”ë¥¼ ìƒìœ„ í´ë” ê·¸ë£¹ì— ì¶”ê°€
                    });

                    fragment.appendChild(parentFolderGroup); // ìƒìœ„ í´ë” ê·¸ë£¹ì„ Fragmentì— ì¶”ê°€
                });

                templateTree.appendChild(fragment); // ìµœì¢…ì ìœ¼ë¡œ Fragmentë¥¼ íŠ¸ë¦¬ì— ì¶”ê°€ (ì„±ëŠ¥ ìµœì í™”)
            } else {
                // ê²°ê³¼ê°€ ì—†ì„ ê²½ìš° "ê²°ê³¼ ì—†ìŒ" í•­ëª© ì¶”ê°€
                const noResultItem = document.createElement("li");
                noResultItem.classList.add("list-group-item");
                noResultItem.textContent = "ê²°ê³¼ ì—†ìŒ";
                templateTree.appendChild(noResultItem);
            }
        } catch (error) {
            // Axios ìš”ì²­ ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ì²˜ë¦¬
            console.error("AXIOS Error:", error.response ? error.response.data : error.message);
            alert(`AXIOS ìš”ì²­ ì‹¤íŒ¨: ${error.response ? error.response.status : error.message}`);
        }
    });
});

